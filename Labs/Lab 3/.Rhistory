shiny::runApp()
# Setup
df_es <-
read_rds("final_dataframe.v3.rds") %>%
mutate(
los_8h =
case_when(
los >= 480 ~ "Yes",
los < 480 ~ "No"
) %>%
as_factor(),
severity = as.numeric(severity),
ald = case_when(ald == 0 ~ "No", .default = "Yes"),
arrival_mode_sas = case_when(
arrival_mode == "Personal" & sas == "Yes" ~ "Personal (SAS)",
arrival_mode == "Personal" & sas == "No" ~ "Personal (not SAS)",
.default = arrival_mode
),
arrival_mode_sas = fct_relevel(arrival_mode_sas, "Personal (SAS)"),
discharge_mode = fct_relevel(discharge_mode, "Home")
)
View(df_es)
# Functions
n_patients <- function(data, p_service, h_entry, h_exit) {
data %>%
filter(
service == p_service &
entry >= h_entry &
exit <= h_exit
) %>%
summarise(n_patients = n()) %>%
pull(n_patients)
}
#
# This is a Shiny web application. You can run the application by clicking
# the 'Run App' button above.
#
# Find out more about building applications with Shiny here:
#
#    https://shiny.posit.co/
#
library(shiny)
library(bslib)
library(tidyverse)
library(DT)
library(plotly)
library(bsicons)
library(broom)
library(marginaleffects)
library(DALEX)
# Functions
n_patients <- function(data, p_service, h_entry, h_exit) {
data %>%
filter(
service == p_service &
entry >= h_entry &
exit <= h_exit
) %>%
summarise(n_patients = n()) %>%
pull(n_patients)
}
# Setup
df_es <-
read_rds("final_dataframe.v3.rds") %>%
mutate(
entry_m2 = entry - hours(2) # This is entry minus 2 hours
) %>%
rowwise() %>%
mutate(
number_patients = n_patients(df, service, entry_m2, exit)
) %>%
ungroup() %>%
group_by(service) %>%
mutate(
time = difftime(max(exit), min(entry), units = "hours"),
n_patients_service = n(),
patients_per_hour = n_patients_service / as.numeric(time)
) %>%
ungroup() %>%
mutate(
hours_spent = difftime(exit, entry_m2, units = "hours"),
los_8h =
case_when(
los >= 480 ~ "Yes",
los < 480 ~ "No"
) %>%
as_factor(),
severity = as.numeric(severity),
ald = case_when(ald == 0 ~ "No", .default = "Yes"),
arrival_mode_sas = case_when(
arrival_mode == "Personal" & sas == "Yes" ~ "Personal (SAS)",
arrival_mode == "Personal" & sas == "No" ~ "Personal (not SAS)",
.default = arrival_mode
),
arrival_mode_sas = fct_relevel(arrival_mode_sas, "Personal (SAS)"),
discharge_mode = fct_relevel(discharge_mode, "Home")
)
# Functions
n_patients <- function(data, p_service, h_entry, h_exit) {
data %>%
filter(
service == p_service &
entry >= h_entry &
exit <= h_exit
) %>%
summarise(n_patients = n()) %>%
pull(n_patients)
}
# Functions
n_patients <- function(data, p_service, h_entry, h_exit) {
data %>%
filter(
service == p_service &
entry >= h_entry &
exit <= h_exit
) %>%
summarise(n_patients = n()) %>%
pull(n_patients)
}
# Setup
df_es <-
read_rds("final_dataframe.v3.rds")
df_es <-
df_es %>%
mutate(
entry_m2 = entry - hours(2) # This is entry minus 2 hours
) %>%
rowwise() %>%
mutate(
number_patients = n_patients(df, service, entry_m2, exit)
) %>%
ungroup() %>%
group_by(service) %>%
mutate(
time = difftime(max(exit), min(entry), units = "hours"),
n_patients_service = n(),
patients_per_hour = n_patients_service / as.numeric(time)
) %>%
ungroup() %>%
mutate(
hours_spent = difftime(exit, entry_m2, units = "hours"),
los_8h =
case_when(
los >= 480 ~ "Yes",
los < 480 ~ "No"
) %>%
as_factor(),
severity = as.numeric(severity),
ald = case_when(ald == 0 ~ "No", .default = "Yes"),
arrival_mode_sas = case_when(
arrival_mode == "Personal" & sas == "Yes" ~ "Personal (SAS)",
arrival_mode == "Personal" & sas == "No" ~ "Personal (not SAS)",
.default = arrival_mode
),
arrival_mode_sas = fct_relevel(arrival_mode_sas, "Personal (SAS)"),
discharge_mode = fct_relevel(discharge_mode, "Home")
)
# Setup
df_es <-
read_rds("final_dataframe.v3.rds")
df_es <-
df_es %>%
mutate(
entry_m2 = entry - hours(2) # This is entry minus 2 hours
) %>%
rowwise() %>%
mutate(
number_patients = n_patients(df_es, service, entry_m2, exit)
) %>%
ungroup() %>%
group_by(service) %>%
mutate(
time = difftime(max(exit), min(entry), units = "hours"),
n_patients_service = n(),
patients_per_hour = n_patients_service / as.numeric(time)
) %>%
ungroup() %>%
mutate(
hours_spent = difftime(exit, entry_m2, units = "hours"),
los_8h =
case_when(
los >= 480 ~ "Yes",
los < 480 ~ "No"
) %>%
as_factor(),
severity = as.numeric(severity),
ald = case_when(ald == 0 ~ "No", .default = "Yes"),
arrival_mode_sas = case_when(
arrival_mode == "Personal" & sas == "Yes" ~ "Personal (SAS)",
arrival_mode == "Personal" & sas == "No" ~ "Personal (not SAS)",
.default = arrival_mode
),
arrival_mode_sas = fct_relevel(arrival_mode_sas, "Personal (SAS)"),
discharge_mode = fct_relevel(discharge_mode, "Home")
)
# Setup
df_es <-
read_rds("final_dataframe.v3.rds")
df_es <-
df_es %>%
mutate(
entry_m2 = entry - hours(2) # This is entry minus 2 hours
) %>%
rowwise() %>%
mutate(
number_patients = n_patients(df_es, service, entry_m2, exit)
) %>%
ungroup() %>%
group_by(service) %>%
mutate(
time = difftime(max(exit), min(entry), units = "hours"),
n_patients_service = n(),
patients_per_hour = n_patients_service / as.numeric(time)
) %>%
ungroup() %>%
mutate(
hours_spent = difftime(exit, entry_m2, units = "hours"),
relative_n_entries = (number_patients/as.numeric(hours_spent))/patients_per_hour,
los_8h =
case_when(
los >= 480 ~ "Yes",
los < 480 ~ "No"
) %>%
as_factor(),
severity = as.numeric(severity),
ald = case_when(ald == 0 ~ "No", .default = "Yes"),
arrival_mode_sas = case_when(
arrival_mode == "Personal" & sas == "Yes" ~ "Personal (SAS)",
arrival_mode == "Personal" & sas == "No" ~ "Personal (not SAS)",
.default = arrival_mode
),
arrival_mode_sas = fct_relevel(arrival_mode_sas, "Personal (SAS)"),
discharge_mode = fct_relevel(discharge_mode, "Home")
)
View(df_es)
View(df_es)
